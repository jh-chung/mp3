---
title: "Mini-Project 3: The Road Not Taken"
author: "Jay-Ho Chung"
date: "4/13/2018"
output: html_document
    theme: spacelab
    df_print: paged
    code_folding: hide
---


```{r Packaages, message=FALSE, warning=FALSE}
library(sf)
library(macleish)
library(leaflet)
library(tidyverse)
library(viridisLite)
```

```{r Identifying Quickly}
macleish_layers[["trails"]] # 15 trails, geometry: Linestring, projection is longlat
```

```{r}
trails <- macleish_layers[["trails"]] %>% 
  mutate(length = st_length(geometry)) %>% 
  group_by(name) %>% 
  summarize(total_length = sum(length))

leaflet() %>% 
  addTiles() %>% 
  addPolylines(data = trails, popup = ~name)
```

```{r, eval=FALSE}
url <- "http://download.massgis.digital.mass.gov/shapefiles/state/contours250k.zip"
local_file <- basename(url)
download.file(url, destfile = local_file)
unzip(local_file)
```

```{r}
boundary <- macleish_layers[["boundary"]]
contour <- st_read("CONTOURS250K_ARC.shp") %>%
  st_transform(4326)
contour
macleish_trail <- st_intersects(boundary, contour)
```

```{r}
contour %>%
  select(CONTOUR_FT) %>%
  plot()
```

```{r}
leaflet() %>% 
  addTiles() %>% 
  addPolygons(data = boundary)
# macleish_trail %>% 
#   plot()
```

```{r}
hiking_trails <- macleish_layers[["trails"]] %>%
  mutate(lengt = st_length(geometry)) %>% 
  group_by(name) %>% 
  mutate(t_length = sum(lengt))

pal <- colorNumeric(
  palette = "viridis",
  domain = hiking_trails$t_length
)

leaflet(data = hiking_trails) %>%
  addTiles() %>%
  addPolylines(color = ~pal(t_length)) %>%
  addLegend("bottomright", pal = pal, values = ~t_length, title = "Trail Length", labFormat = labelFormat(suffix =  "m"))
```

```{r}
leaflet() %>%
  addTiles() %>%
  addPolylines(data = macleish_layers[["trails"]], color = "black", weight = 3, opacity = .5) %>%
  addPolylines(data = macleish_layers[["contours_3m"]], weight = 1, opacity = .5)
```

```{r}
m3_contour <- macleish_layers[["contours_3m"]] %>% 
  select(ELEV_M, ELEV_FT, INDEX_ARC, SHAPE_LEN, geometry)
```

```{r}
macleish_cont <- st_intersects(trails,
                               macleish_layers[["contours_3m"]])
cont_data <- st_join(trails, m3_contour)

contour_data <- cont_data %>% 
  group_by(name) %>% 
  summarize(low = min(ELEV_FT), high = max(ELEV_FT),
            change = high - low)

pal1 <- colorNumeric(
  palette = "viridis",
  domain = contour_data$change
)

leaflet(contour_data) %>% 
  addTiles() %>% 
  # addPolylines(data = trails) %>% 
  addPolylines(data = contour_data, color = ~pal1(change),
               label = ~name) %>% 
  addLegend("bottomright", pal = pal1, 
            values = ~change, 
            title = "Trail Change in Elevation",
            labFormat = labelFormat(suffix = " ft."))
```

```{r}
cont_trail <- st_join(trails, contour_data, join = st_within) %>% 
  mutate(diff_level = change / total_length)
  # group_by(name.x)
```



```{r}
cont_trail <- st_join(trails, contour_data, join = st_within) %>% 
  mutate(hard_meas = sqrt(2*(contour_data$change)*(trails$total_length))) %>%
  arrange(desc(hard_meas))
```

IDEA: Total elevation change / trail length
Also include layers and see how many times each trail intersects with the contours

Also maybe should think about getting units to be the same and maybe thinking of better measure of what makes a trail hard


```{r (Combing Trails and Contour)}
trail_cont <- st_join(trails, contour_data, join = st_within , suffix = c("name" = "name")) %>% # st_within is the join type
  mutate(hard_meas = sqrt(2*(contour_data$change*3.28084)*(trails$total_length*0.000621371))) %>% # Using the equation from the National Park Service
  select(nameNA , change , total_length , hard_meas) %>%
  arrange((hard_meas)) # Want to arrange it

```


```{r}
pal1 <- colorNumeric(
  palette = "viridis",
  domain = trail_cont$hard_meas
)

leaflet(data = trail_cont) %>%
  addTiles() %>% # Adding tiles fro the background
  addPolylines(data = trails , color = ~pal1(trail_cont$hard_meas) , label = ~name) %>%
  addLegend("bottomright", pal = pal1, 
            values = ~hard_meas, 
            title = "Difficulty",
            labFormat = labelFormat(suffix = " NPS Difficulty Scale"))
```